{extend name="default/base" /}
{block name="content"}
<div class="container content" id="cart">
    <h4>购物车</h4>
    <hr>
    {if sizeof($goods) > 0}
    {foreach $goods as $v}
    <div class="row cart-list">
        <div class="col-md-3 col-sm-3 col-xs-7">
            <div class="input-group">
                  <span class="input-group-addon">
                    <input type="checkbox" name="cat-id" value="{$v.cat_id}" class="checkbox-inline checkbox">
                  </span>
                <img src="{$v.good_cat.good.img_url|default='/static/img/null.png'}" alt="{$v.good_cat.good.title}" width="120px" class="thumbnail" style="margin-bottom: 0">
            </div>
        </div>
        <div class="detail col-md-6 col-sm-6 col-xs-5">
            <a href="{:url('index/good/good', ['id' => $v.good_cat.good_id])}">
                {$v.good_cat.good.title}
            </a>
            {if $v.good_cat.good.is_prescription == 1}<p class="red">处方药</p>{/if}
            <p>分类：{$v.good_cat.name}</p>
        </div>

        <div class="input-group col-md-3 col-sm-3 col-xs-5">
            <h4>￥{$v.good_cat.price}</h4>
            <input type="number" class="input-sm form-control" name="cat-num" data-id="{$v.cat_id}" value="{$v.num}" max="99" min="1" style="width: 70px">
            <input type="button" class="btn btn-sm btn-default" onclick="del({$v.cat_id});" value="删除">

        </div>
    </div>
    <hr>
    {/foreach}
    <label><input id="checkall" class="text-left" type="checkbox" onclick="checkall()"> 全选</label>
    <form action="{:url('index/good/checkout')}" method="post" id="shop" class="text-right">
        <input name="cat" hidden>
        <input name="num" hidden>
        <input value="提交订单" class="btn btn-info"  onclick="check();" type="button">
    </form>
    {else}
    <h3>暂时没有商品</h3>
    {/if}
</div>
{/block}
{block name="extendjs"}
<script>
    function del(cat_id) {
        var pageObj = this;
        var url = pageObj.href;
        $.ajax({
            type:'post',
            url:url,
            data: {'del': cat_id},
            success:function(res){
                $("#cart").html(res);
            },
        });
        return false;
    }

    function check(){
        var cat = new Array();
        var num = new Array();
        $('input[name=cat-id]:checked').each(function() {
            cat.push($(this).val());
            num.push($('input[data-id="'+$(this).val()+'"]').val());
        });

        var cat = cat.join(',');
        var num = num.join(',');

        $('input[name=cat]').val(cat);
        $('input[name=num]').val(num);

        if(cat != '' && num != '')
            $('#shop').submit();
    }

    function checkall(){
        if ($('#checkall').is(':checked'))
            $('.checkbox').prop('checked', true);
        else
            $('.checkbox').prop('checked', false);
    }
</script>
{/block}